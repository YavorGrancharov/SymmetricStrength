let commentController=(()=>{function e(e){let t=e.getDate(),a=e.getMonth(),n=e.getFullYear();return t+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a]+" "+n}return{getComments:function(){$(document).ready(function(){let t=$("#id").val();commentService.getCommentsById(t).then(t=>{t.forEach(t=>{$(".comment-list").prepend($(`<li class="comment" id="${t._id}"></li>`).append($('<div class="comment-body"></div>').append($('<div class="comment-head"></div>').append($('<div class="comment-avatar"></div>').append($(`<img alt="avatar" src="${t.avatar}">`))).append($('<div class="comment-info"></div>').append($(`<h5 class="title">${t.author}</h5>`)).append($(`<span class="comment-date">${t.date}</span>`)))).append($('<div class="comment-context"></div>').append($(`<p>${t.comment}</p>`)).append($('<div class="reply"></div>').append($('<span class="comment-reply"></span>').append($('<a class="comment-reply-link" href="#/">Reply</a>').on("click",function(a){a.preventDefault();let n=$(this),l=$(this.parentNode),i=t._id;$(l).append($('<form action="#/" method="post" class="contact" style="margin-top: 10px"></form>').append($('<div class="contact-item"></div>').append($('<input name="author-reply" value="" id="author-reply" type="text" placeholder="Име *">'))).append($('<div class="contact-item"></div>').append($('<input name="email-reply" value="" id="email-reply" type="email" placeholder="По избор с е-поща в Gravatar">'))).append($('<div class="contact-item"></div>').append($('<textarea name="reply" id="reply" class="commentBox" placeholder="Коментар *"></textarea>'))).append($('<div class="contact-item form-submit"></div>').append($('<input name="submit-reply" type="submit" id="submit-reply" class="submit" value="ИЗПРАТИ">').on("click",function(t){t.preventDefault();let a=i,p=e(new Date),r=$("#author-reply").val(),s=$("#email-reply").val(),c="",o=$("#reply").val(),m=grecaptcha.getResponse(),d=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gim;if(""!==r)if(r.length<3)alert("Името трябва да бъде с дължина не по-малка от три букви!");else if(/^[a-zA-Z|а-яА-ЯЁё]{3,}((\s[a-zA-Z|а-яА-ЯЁё ])?[a-zA-Z|а-яА-ЯЁё]*)*$/gm.test(r)){if(""!==s){if(!d.test(String(s).toLowerCase()))return void alert("Въведете валидна е-поща!");c="https://www.gravatar.com/avatar/"+md5(String(s).toLowerCase().trim())}else c="https://www.gravatar.com/avatar/"+md5(String(s).toLowerCase().trim())+"?f=y";""!==o?o.length<5||o.length>250?alert("Коментарът трябва да бъде с дължина между 5 и 250 символа!"):0!==m.length?(commentService.postReply(a,p,r,c,o,!1).then(function(){alert("Благодарим Ви за коментара!"),window.location.hash="current",$(l.context.children[1]).remove(),$(n).show()}),$("#author-reply").val(""),$("#email-reply").val(""),$("#reply").val(""),grecaptcha.reset()):alert("Удостоверете с тикче квадратчето 'Не съм робот'"):alert("Въведете коментар в предвиденото за това поле!")}else alert("Името може да съдържа само букви!");else alert("Въведете името си в предвиденото за това поле!")})).append($('<input name="hide" type="submit" style="margin: 5px" id="hide" class="submit" value="ЗАТВОРИ">').on("click",function(e){e.preventDefault(),$(n).show(),$(l[0].lastChild).remove()})))),$(n).hide()}))))))),commentService.getRepliesById(t._id).then(e=>{let t=$(".comment");e.forEach(e=>{for(let a=0;a<t.length;a++)t[a].id===e.id&&$(t[a]).append($('<ul class="children"></ul>').prepend($('<li class="comment" id="current"></li>').append($('<div class="comment-body"></div>').append($('<div class="comment-head"></div>').append($('<div class="comment-avatar"></div>').append($(`<img alt="avatar" src="${e.avatar}">`))).append($('<div class="comment-info"></div>').append($(`<h5 class="title">${e.author}</h5>`)).append($(`<span class="comment-date">${e.date}</span>`)))).append($('<div class="comment-context"></div>').append($(`<p>${e.comment}</p>`))))))})})});let a=$(".post-comments");$(a)[0].innerHTML=t.length+" Коментари",1===t.length?$(".comment-list").prepend(`<h2 class="title"><span>${t.length} Коментар</span></h2>`):$(".comment-list").prepend(`<h2 class="title"><span>${t.length} Коментари</span></h2>`)})})},postComment:function(){$(document).ready(function(){$("#submit").click(function(t){t.preventDefault();let a=$("#id").val(),n=e(new Date),l=$("#author").val(),i=$("#email").val(),p="",r=$("#comment").val(),s=grecaptcha.getResponse(),c=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/gim;if(""!==l)if(l.length<3)alert("Името трябва да бъде с дължина не по-малка от три букви!");else if(/^[a-zA-Z|а-яА-ЯЁё]{3,}((\s[a-zA-Z|а-яА-ЯЁё ])?[a-zA-Z|а-яА-ЯЁё]*)*$/gm.test(l)){if(""!==i){if(!c.test(String(i).toLowerCase()))return void alert("Въведете валидна е-поща!");p="https://www.gravatar.com/avatar/"+md5(String(i).toLowerCase().trim())}else p="https://www.gravatar.com/avatar/"+md5(String(i).toLowerCase().trim())+"?f=y";""!==r?r.length<5||r.length>250?alert("Коментарът трябва да бъде с дължина между 5 и 250 символа!"):0!==s.length?(commentService.postComment(a,n,l,p,r).then(function(){alert("Благодарим Ви за коментара!"),window.location.hash=`${a}`}),$("#author").val(""),$("#email").val(""),$("#avatar").val(""),$("#comment").val(""),grecaptcha.reset()):alert("Удостоверете с тикче квадратчето 'Не съм робот'"):alert("Въведете коментар в предвиденото за това поле!")}else alert("Името може да съдържа само букви!");else alert("Въведете името си в предвиденото за това поле!")})})}}})();